<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>godot-luau-script Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item affix "><li class="part-title">Usage</li><li class="chapter-item "><a href="usage/building-and-installation.html"><strong aria-hidden="true">1.</strong> Building and Installation</a></li><li class="chapter-item "><a href="usage/writing-scripts/index.html"><strong aria-hidden="true">2.</strong> Writing Scripts</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="usage/writing-scripts/accessing-godot.html"><strong aria-hidden="true">2.1.</strong> Accessing Godot APIs</a></li><li class="chapter-item "><div><strong aria-hidden="true">2.2.</strong> Godot Class Reference</div></li><li class="chapter-item "><a href="usage/writing-scripts/luau-script-api.html"><strong aria-hidden="true">2.3.</strong> godot-luau-script API Reference</a></li><li class="chapter-item "><a href="usage/writing-scripts/idiomatic-class.html"><strong aria-hidden="true">2.4.</strong> The "Idiomatic" Class</a></li><li class="chapter-item "><a href="usage/writing-scripts/virtual-methods.html"><strong aria-hidden="true">2.5.</strong> Virtual Methods</a></li><li class="chapter-item "><a href="usage/writing-scripts/core-scripts-vms-permissions.html"><strong aria-hidden="true">2.6.</strong> "Core Scripts", VMs, and Permissions</a></li><li class="chapter-item "><a href="usage/writing-scripts/modules.html"><strong aria-hidden="true">2.7.</strong> Modules</a></li><li class="chapter-item "><a href="usage/writing-scripts/task-scheduler.html"><strong aria-hidden="true">2.8.</strong> The Task Scheduler</a></li><li class="chapter-item "><a href="usage/writing-scripts/typechecking-autocomplete.html"><strong aria-hidden="true">2.9.</strong> Typechecking and Autocomplete</a></li></ol></li><li class="chapter-item "><a href="usage/known-issues.html"><strong aria-hidden="true">3.</strong> Known Issues</a></li><li class="chapter-item affix "><li class="part-title">Development</li><li class="chapter-item "><a href="development/tests.html"><strong aria-hidden="true">4.</strong> Tests</a></li><li class="chapter-item "><a href="development/debugging.html"><strong aria-hidden="true">5.</strong> Debugging</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">godot-luau-script Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><code>godot-luau-script</code> is a GDExtension adding support for Roblox's <a href="https://luau-lang.org/">Luau</a>, a superset of Lua 5.1, to Godot 4.</p>
<p>It is developed mostly with <a href="https://github.com/Fumohouse/Fumohouse">Fumohouse</a> in mind, but it can be used in other projects.</p>
<h2 id="priorities"><a class="header" href="#priorities">Priorities</a></h2>
<p>This particular implementation has a few specific goals:</p>
<ul>
<li>Allow for (relatively) safe loading of user-generated content (UGC) including scripts
<ul>
<li>Sandbox &quot;core&quot; and &quot;user&quot; scripts from each other (separate Lua VMs)</li>
<li>Enforce permission levels for restricted APIs (like networking or filesystem access)</li>
<li>Limit breakage of the game by user scripts</li>
</ul>
</li>
<li>Support typechecking of source files</li>
</ul>
<p>Note that <code>godot-luau-script</code> was specifically built for loading untrusted UGC.
As such, other languages like GDScript may be more suitable if UGC support is not needed
(that is, unless you are partial to Luau as a language).</p>
<h2 id="disclaimer"><a class="header" href="#disclaimer">Disclaimer</a></h2>
<p>This project is still in relatively early stages. Please keep in mind:</p>
<ul>
<li><strong>(Potentially major) breaking changes will happen often and whenever necessary.</strong></li>
<li>This documentation may be incomplete or out-of-date. Please <a href="https://github.com/Fumohouse/godot-luau-script/issues/new/choose">report an issue</a> if this is the case.</li>
<li>Building on any platform except for MSVC on Windows and LLVM on Linux is untested. Report an issue if you encounter issues building.</li>
<li>Some editor functionality is still not implemented (mostly debugging, profiling, and analysis/autocomplete support) and won't be for some time.</li>
<li>Some security issues may remain.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-and-installation"><a class="header" href="#building-and-installation">Building and Installation</a></h1>
<h2 id="building"><a class="header" href="#building">Building</a></h2>
<p><code>godot-luau-script</code> uses <a href="https://scons.org/">SConstruct</a> to build.
Currently, no prebuilt binaries are provided.</p>
<h3 id="cloning"><a class="header" href="#cloning">Cloning</a></h3>
<p>The three dependencies this project has, godot-cpp, Luau, and Catch2, are added as submodules in <code>extern/</code>.
As such, make sure to clone submodules when cloning this project:</p>
<ul>
<li><code>git clone https://github.com/Fumohouse/godot-luau-script --recurse-submodules</code>, or</li>
<li><code>git submodule update --recursive</code> if the repository is already cloned.</li>
</ul>
<h4 id="windows"><a class="header" href="#windows">Windows</a></h4>
<p><code>godot-luau-script</code> uses a symlink to link <code>bin/</code> to <code>test_project/bin/</code>.
These symbolic links are not supported on Windows.
If you want to run tests, you will need to copy the folder (including built binaries) yourself.</p>
<h3 id="supported-platforms"><a class="header" href="#supported-platforms">Supported platforms</a></h3>
<p><code>godot-luau-script</code> officially supports compilation using recent versions of Clang, GCC, and MSVC,
and building for Windows, macOS, and Linux.
LLVM (<code>clang++</code>, <code>clangd</code>, <code>clang-format</code>) utilities are preferred where possible.</p>
<h3 id="building-1"><a class="header" href="#building-1">Building</a></h3>
<p>Ensure that a supported toolchain is installed.
You will also need to install <a href="https://www.python.org/">Python 3</a> and run <code>python -m pip install scons</code> to install SConstruct
(or, if on Linux, SConstruct is available through some package repositories).</p>
<p>If you are running a Python version older than 3.11, you will need to <code>python -m pip install tomli</code> for TOML support.</p>
<p>Build the project by running <code>scons</code> at the project root. The following flags are supported:</p>
<ul>
<li><code>tests=yes</code>: Build with Catch2 tests included.</li>
<li><code>iwyu=yes</code>: Run <a href="https://github.com/include-what-you-use/include-what-you-use"><code>include-what-you-use</code></a> instead of the compiler to find potential <code>#include</code> mistakes.</li>
<li><code>generate_luau_bindings=yes</code>: Force regeneration of any auto-generated files (see <code>bindgen/</code>).</li>
<li><code>cdb</code>: Force generation of the <code>compile_commands.json</code>, which is used by language servers like <code>clangd</code> for analysis.</li>
</ul>
<p>Additionally, you may want to use the following flags from godot-cpp:</p>
<ul>
<li><code>target=editor</code>: Build for the editor.</li>
<li><code>target=template_release</code>: Build for release templates.</li>
<li><code>use_llvm=yes</code>: Force usage of LLVM for compilation (over GCC).</li>
<li><code>debug_symbols=yes</code>: Build the project with debug symbols.</li>
</ul>
<p>After building, output will be present in the <code>bin/</code> folder.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p>Installing <code>godot-luau-script</code> is relatively easy.
All necessary GDExtension files are provided in <code>bin/</code>; it should suffice to copy the entire folder into your Godot project.
After reloading the project, the extension should be loaded and you should be able to create a Luau script through the script creation dialog.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="writing-scripts"><a class="header" href="#writing-scripts">Writing Scripts</a></h1>
<p>Since <code>godot-luau-script</code> supports most of Godot's script language functionality,
you should be able to accomplish the same things as you could with another language like GDScript or C#.</p>
<p>This includes creating and extending your own classes, registering methods to be called from Godot (e.g. through a signal),
registering and connecting your own signals, using RPCs, registering AutoLoad scripts, etc.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="accessing-godot-apis"><a class="header" href="#accessing-godot-apis">Accessing Godot APIs</a></h1>
<p>The majority of builtin and <code>Object</code> classes are bound from Godot to Luau.
A selection of utility functions from Godot are also available.</p>
<p>To find out what APIs are exposed, you can refer to the <code>definitions/luauScriptTypes.gen.d.lua</code> file after building (beware: this file is large!)
or rely on autocomplete to tell you (after setting that up).</p>
<p>For the most part, you can refer to <a href="https://docs.godotengine.org/en/latest/">Godot's documentation</a> to discover the API.
After learning the rules below, this should become relatively intuitive.</p>
<h2 id="renaming-rules"><a class="header" href="#renaming-rules">Renaming rules</a></h2>
<p>Most members are renamed from their Godot names to the following convention:</p>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Godot Case</th><th>Luau Case</th></tr></thead><tbody>
<tr><td>Classes and enums</td><td><code>PascalCase</code></td><td><em>unchanged</em></td></tr>
<tr><td>Utility functions</td><td><code>snake_case</code></td><td><em>unchanged with few exceptions</em></td></tr>
<tr><td>Enum values</td><td><code>PREFIX_UPPER_SNAKE_CASE</code></td><td><code>UPPER_SNAKE_CASE</code> <em>with exceptions</em> *</td></tr>
<tr><td>Constants</td><td><code>UPPER_SNAKE_CASE</code></td><td><em>unchanged</em></td></tr>
<tr><td>Methods</td><td><code>snake_case</code></td><td><code>PascalCase</code></td></tr>
<tr><td>Properties/signals</td><td><code>snake_case</code></td><td><code>camelCase</code></td></tr>
</tbody></table>
</div>
<p>*: e.g. for the <code>PropertyUsage</code> enum, the prefix on all values is <code>PROPERTY_USAGE_</code>; this is removed.
Additionally, if an enum name begins with a number after renaming (e.g. <code>KEY_9</code> with prefix <code>KEY_</code> -&gt; <code>9</code>), an <code>N</code> will be prepended to the name -&gt; <code>N9</code>.</p>
<h2 id="accessible-apis"><a class="header" href="#accessible-apis">Accessible APIs</a></h2>
<h3 id="globals"><a class="header" href="#globals">Globals</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Godot Access</th><th>Luau Access</th><th>GDScript Example</th><th>Luau Example</th></tr></thead><tbody>
<tr><td>Global enum</td><td><code>@GlobalScope</code></td><td><code>Enum.</code> namespace</td><td><code>MARGIN_LEFT</code></td><td><code>Enum.Margin.LEFT</code></td></tr>
<tr><td>Global constant</td><td><code>@GlobalScope</code></td><td><code>Constants.</code> namespace</td><td><em>N/A</em></td><td><em>N/A</em></td></tr>
<tr><td>Utility function</td><td><code>@GlobalScope</code></td><td><code>_G</code></td><td><code>lerpf(0.0, 1.0, 0.5)</code></td><td><code>lerp(0, 1, 0.5)</code> *</td></tr>
</tbody></table>
</div>
<p>*: This is one of the renamed functions mentioned above.</p>
<h3 id="variant-and-object-classes"><a class="header" href="#variant-and-object-classes">Variant and Object classes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>Godot Access</th><th>Luau Access</th><th>GDScript Example</th><th>Luau Example</th></tr></thead><tbody>
<tr><td>Variant constructors</td><td><code>&lt;ClassName&gt;</code></td><td><code>&lt;ClassName&gt;.new</code></td><td><code>Vector3(0, 1, 0)</code></td><td><code>Vector3.new(0, 1, 0)</code></td></tr>
<tr><td>Object constructors</td><td><code>&lt;ClassName&gt;.new</code></td><td><em>unchanged</em></td><td><code>AESContext.new()</code></td><td><em>unchanged</em></td></tr>
<tr><td>Object singleton</td><td><code>&lt;ClassName&gt;</code></td><td><code>&lt;ClassName&gt;.GetSingleton()</code></td><td></td><td></td></tr>
<tr><td>Static methods</td><td><code>&lt;ClassName&gt;.&lt;Method&gt;</code></td><td><em>unchanged</em></td><td><code>Vector2.from_angle(x)</code></td><td><code>Vector2.FromAngle(x)</code></td></tr>
<tr><td>Instance methods static call</td><td><em>N/A</em></td><td><code>&lt;ClassName&gt;.&lt;Method&gt;</code></td><td><em>N/A</em></td><td><code>Vector2.Dot(v1, v2)</code></td></tr>
<tr><td>Instance methods</td><td><code>&lt;Instance&gt;.&lt;Method&gt;</code></td><td><code>&lt;Instance&gt;:&lt;Method&gt;</code></td><td><code>v1.dot(v2)</code></td><td><code>v1:Dot(v2)</code></td></tr>
<tr><td>Member/property/signal access</td><td><code>&lt;Instance&gt;.&lt;Property&gt;</code></td><td><em>unchanged</em> *</td><td><code>vector.x</code></td><td><em>unchanged</em></td></tr>
<tr><td>Keyed/indexed set</td><td><code>&lt;Instance&gt;[&lt;Key&gt;] = &lt;Value&gt;</code></td><td><code>&lt;Instance&gt;:Set(&lt;Key&gt;, &lt;Value&gt;)</code></td><td><code>dictionary[&quot;key&quot;] = 1</code></td><td><code>dictionary:Set(&quot;key&quot;, 1)</code></td></tr>
<tr><td>Keyed/indexed get</td><td><code>&lt;Instance&gt;[&lt;Key&gt;]</code></td><td><code>&lt;Instance&gt;:Get(&lt;Key&gt;)</code></td><td><code>dictionary[&quot;key&quot;]</code></td><td><code>dictionary:Get(&quot;key&quot;)</code></td></tr>
<tr><td>Array length</td><td><code>&lt;Array&gt;.size()</code></td><td><code>&lt;Array&gt;:Size()</code> OR <code>#&lt;Array&gt;</code></td><td><code>array.size()</code></td><td><code>array:Size()</code> OR <code>#array</code></td></tr>
<tr><td>Array iteration</td><td><code>for item in &lt;Array&gt;:</code></td><td><code>for index, item in &lt;Array&gt; do</code> **</td><td></td><td></td></tr>
<tr><td>Dictionary iteration</td><td><code>for key in &lt;Dictionary&gt;:</code></td><td><code>for key, value in &lt;Dictionary&gt; do</code> **</td><td></td><td></td></tr>
<tr><td>Variant type operators</td><td><code>&lt;A&gt; &lt;Op&gt; &lt;B&gt;</code>/<code>&lt;Unary&gt;&lt;A&gt;</code></td><td><em>unchanged</em> ***</td><td><code>v1 == v2</code></td><td><em>unchanged</em></td></tr>
<tr><td>Variant/Object to string</td><td><code>str(&lt;Instance&gt;)</code></td><td><code>tostring(&lt;Instance&gt;)</code></td><td></td><td></td></tr>
</tbody></table>
</div>
<p>*: Variant type properties (e.g. <code>Vector2.x</code>) <strong>cannot be set</strong> because Luau does not support copy on assign (as C++ and GDScript do). You must construct a new object instead. <br />
**: Iterators do not support modification during iteration. Doing so may cause errors or for items to be skipped. <br />
***: Some Godot operators are not supported as they do not exist in Luau. Also, <code>==</code> comparison is not allowed between two different types in Luau, so these operators do not work.</p>
<h3 id="odd-exceptions"><a class="header" href="#odd-exceptions">Odd exceptions</a></h3>
<ul>
<li>For security (permissions) reasons, the only supported <code>Callable</code> constructor is <code>Callable.new(object: Object, methodName: string | StringName)</code>.</li>
<li><code>String</code>, <code>StringName</code>, and <code>NodePath</code> are not bound to Luau as Luau's builtin <code>string</code> suffices in the vast majority of cases. <code>StringName</code> and <code>NodePath</code> can be constructed manually if needed (e.g. if a <code>String</code> type would be inferred over the other two types) by using the <code>SN</code> or <code>NP</code> global functions respectively.
<ul>
<li>The intention with these constructors is to use them like a prefix you would find in other languages, e.g. <code>SN&quot;testStringName&quot;</code>. This is valid because of Lua's lenient parsing rules.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="godot-luau-script-api-reference"><a class="header" href="#godot-luau-script-api-reference"><code>godot-luau-script</code> API Reference</a></h1>
<p><code>godot-luau-script</code> provides its own library on top of bindings to Godot in order to allow custom class creation
and provide various other useful functions (e.g. <code>wait</code> and <code>require</code>).</p>
<p>Currently, this library is defined and documented in <code>definitions/luauLibTypes.part.d.lua</code>.
A generated page for this documentation is planned.</p>
<pre><code class="language-lua">---------------------
-- LUAGD_LIB TYPES --
---------------------

--[[--
    Extension to Luau's default string library which includes some commonly used methods
    which are not implemented in Luau.
]]
declare strext: {
    --[[--
        Finds whether a string starts with another string.
        @param self The string being queried.
        @param str The start string.
    ]]
    startswith: (self: string, str: string) -&gt; boolean,

    --[[--
        Finds whether a string ends with another string.
        @param self The string being queried.
        @param str The end string.
    ]]
    endswith: (self: string, str: string) -&gt; boolean,
}

--[[--
    Constructs a new `StringName`.
    @param str The string to use.
]]
declare function SN(str: string): StringName

--[[--
    Constructs a new `NodePath`.
    @param str The string to use.
]]
declare function NP(str: string): NodePath

-- TODO: constrain to Resource type?
--[[--
    Loads a resource. Mostly an alias for `ResourceLoader.GetSingleton():Load()`.
    @param path The **relative** path to the resource from this script.
]]
declare function load&lt;T&gt;(path: string): T?

--[[--
    Determines the Godot Variant type of a value, or `nil` if the value is not Variant-compatible.
    @param value The value.
]]
declare function gdtypeof(value: any): EnumVariantType?

--------------------
-- LUAU_LIB TYPES --
--------------------

export type EnumPermissions = number

declare class EnumPermissions_INTERNAL
    --- Used for functionality that is available to all scripts by default.
    BASE: EnumPermissions

    --- Used for all functionality which is not part of any special permission level or `BASE`.
    INTERNAL: EnumPermissions

    --- Used for the `OS` singleton.
    OS: EnumPermissions

    --- Used for any functionality with read or write access to the filesystem.
    FILE: EnumPermissions

    --- Used for any functionality allowing HTTP listen/requests.
    HTTP: EnumPermissions
end

--[[--
    Indicates permission levels for script execution.
    Only core scripts can declare permissions, through @see GDClassDefinition.Permissions.
]]
declare EnumPermissions: EnumPermissions_INTERNAL

--[[--
    A table type used to declare properties, method arguments, and return values.
]]
export type GDProperty = {
    type: EnumVariantType?,
    name: string?,
    hint: EnumPropertyHint?,
    hintString: string?,
    usage: EnumPropertyUsageFlags?,
    className: string?,
}

--[[--
    A type used for registering methods to a @see GDClassDefinition.
]]
declare class GDMethod
    --[[--
        Registers arguments for the method.
        @varargs Arguments to be registered.
    ]]
    function Args(self, ...: GDProperty): GDMethod

    --[[--
        Registers default arguments for the method.
        @varargs Default values for arguments, with the rightmost value corresponding to the rightmost argument.
    ]]
    function DefaultArgs(self, ...: Variant): GDMethod

    --[[--
        Registers a return value for the method.
        @param val The return type.
    ]]
    function ReturnVal(self, val: GDProperty): GDMethod

    --[[--
        Registers any special flags for the method.
        @param flags The flags.
    ]]
    function Flags(self, flags: EnumMethodFlags): GDMethod
end

--[[--
    A type used for registering properties to a @see GDClassDefinition.
]]
declare class GDClassProperty
    --[[--
        Registers a default value for the property.
        @param value The value.
    ]]
    function Default(self, value: Variant): GDClassProperty

    --[[--
        Registers a setter and/or a getter for the property.
        @param setter The method name of the setter.
        @param getter The method name of the getter.
    ]]
    function SetGet(self, setter: string?, getter: string?): GDClassProperty

    -- HINT HELPERS --

    --[[--
        Registers a range and step for a numeric property.
        @param min The minimum value.
        @param max The maximum value.
        @param step The increment Godot will use in the editor.
    ]]
    function Range(self, min: number, max: number, step: number?): GDClassProperty

    --[[--
        Registers enum values to be used by the editor, for a string or integer property.
        @varargs The enum values.
    ]]
    function Enum(self, ...: string): GDClassProperty

    --[[--
        Registers a set of suggestions for a string property, similar to @see GDClassProperty.Enum
        but allowing any value to be input in the editor.
        @varargs The suggested values.
    ]]
    function Suggestion(self, ...: string): GDClassProperty

    --[[--
        Registers a set of bit flags which can be set/unset for an integer property.
        @varargs The names of each flag.
    ]]
    function Flags(self, ...: string): GDClassProperty

    --[[--
        Indicates that a string property should be for a file path.
        @param isGlobal Whether the path is global or local to the `res://` filesystem.
        @varargs An accepted set of path filters, e.g. `*.png`.
    ]]
    function File(self, isGlobal: boolean, ...: string): GDClassProperty

    --[[--
        Indicates that a string property should be for a directory path.
        @param isGlobal Whether the path is global or local to the `res://` filesystem.
    ]]
    function Dir(self, isGlobal: boolean): GDClassProperty

    --[[--
        Indicates that a string property should have a multiline text box in the editor.
    ]]
    function Multiline(self): GDClassProperty

    --[[--
        Registers a placeholder to be shown in the text box for a string property with no value.
        @param placeholder The placeholder.
    ]]
    function TextPlaceholder(self, placeholder: string): GDClassProperty

    --[[--
        Indicates an integer property should show the flags for 2D render layers.
    ]]
    function Flags2DRenderLayers(self): GDClassProperty

    --[[--
        Indicates an integer property should show the flags for 2D physics layers.
    ]]
    function Flags2DPhysicsLayers(self): GDClassProperty

    --[[--
        Indicates an integer property should show the flags for 2D navigation layers.
    ]]
    function Flags2DNavigationLayers(self): GDClassProperty

    --[[--
        Indicates an integer property should show the flags for 3D render layers.
    ]]
    function Flags3DRenderLayers(self): GDClassProperty

    --[[--
        Indicates an integer property should show the flags for 3D physics layers.
    ]]
    function Flags3DPhysicsLayers(self): GDClassProperty

    --[[--
        Indicates an integer property should show the flags for 3D navigation layers.
    ]]
    function Flags3DNavigationLayers(self): GDClassProperty

    --[[--
        Indicates a float property should be edited through an exponential easing function.
        @param hint Either &quot;attenuation&quot; to indicate a flipped curve or &quot;positive_only&quot; to limit values to positive only.
    ]]
    function ExpEasing(self, hint: &quot;attenuation&quot; | &quot;positive_only&quot;): GDClassProperty

    --[[--
        Indicates a color property should not allow alpha value to be edited.
    ]]
    function NoAlpha(self): GDClassProperty

    --[[--
        Indicates an array property should be constrained to a specific type.
        @param type The name of the type.
        @param isResource Whether the type is the class name of a resource.
    ]]
    function TypedArray(self, type: string, isResource: boolean?): GDClassProperty

    --[[--
        Indicates an object property should be constrained to a specific resource type.
        @param type The name of the type.
    ]]
    function Resource(self, type: string): GDClassProperty

    --[[--
        Constrains a NodePath property to specific node types.
        @varargs The names of the types.
    ]]
    function NodePath(self, ...: string): GDClassProperty
end

declare class GDSignal
    --[[--
        Registers arguments for the signal.
        @varargs Arguments to be registered.
    ]]
    function Args(self, ...: GDProperty): GDMethod
end

--[[--
    A type used for registering an RPC to a @see GDClassDefinition.
]]
export type GDRpcConfig = {
    rpcMode: ClassEnumMultiplayerAPI_RPCMode,
    transferMode: ClassEnumMultiplayerPeer_TransferMode,
    callLocal: boolean,
    channel: number,
}

--[[--
    A type returned from a script to register a custom class type.
]]
declare class GDClassDefinition
    --[[--
        Constructs a new instance of the base object with this script.
    ]]
    new: () -&gt; Object

    --[[--
        Indicates whether this script is instantiable in the editor (tool script).
        @param isTool Whether this script is a tool script.
    ]]
    function Tool(self, isTool: boolean): GDClassDefinition

    --[[--
        Declares permissions for instances of this script. Only valid for core scripts.
        @param permissions Declared permissions.
    ]]
    function Permissions(self, permissions: EnumPermissions): GDClassDefinition

    --[[--
        Declares an icon path for this type.
        @param path Path to a .svg image.
    ]]
    function IconPath(self, path: string): GDClassDefinition

    --[[--
        Registers an implementation table for any methods, constants, etc.
        Items in this table will be accessible by indexing this class definition.
        This is used primarily to assist the typechecker.
        @param table The implementation table.
    ]]
    RegisterImpl: &lt;T&gt;(self: GDClassDefinition, table: T) -&gt; GDClassDefinition &amp; T

    -- REGISTRATION METHODS --

    --[[--
        Registers a method.
        @param name The name of the method defined in the implementation table.
    ]]
    function RegisterMethod(self, name: string): GDMethod

    --[[--
        Registers a method and automatically declares its arguments and return value based on type annotations.
        @param name The name of the method defined in the implementation table.
    ]]
    function RegisterMethodAST(self, name: string): GDMethod

    --[[--
        Registers a property which will be accessible by indexing instances of this script.
        @param name The name of the property.
        @param propertyOrType The @see GDProperty indicating the type of this property, or an @see EnumVariantType if advanced information is not needed.
    ]]
    function RegisterProperty(self, name: string, propertyOrType: EnumVariantType | GDProperty): GDClassProperty

    --[[--
        Registers a signal which will be accessible by indexing instances of this script.
        @param name The name of the signal.
    ]]
    function RegisterSignal(self, name: string): GDSignal

    --[[--
        Registers an RPC.
        @param rpcConfig The RPC configuration.
    ]]
    function RegisterRpc(self, rpcConfig: GDRpcConfig)

    --[[--
        Registers a constant which will be accessible by indexing instances of this script.
        The recommended way create constants unless they must be accessible to Godot is by defining them on the implementation table.
        @param name The name of the constant.
        @param value The value of the constant.
    ]]
    function RegisterConstant(self, name: string, value: Variant)

    -- METAMETHODS --

    --[[--
        Gets a value on the implementation table, erroring if one has not been created.
    ]]
    function __index(self, key: string): any
end

--[[--
    Creates a new @see GDClassDefinition.
    @param name The name of the class. This makes it &quot;global&quot; in the Godot editor, meaning it will, for example, show up in the Node/Resource creation dialogs.
    @param extends The Luau or Godot class this class extends.
]]
declare function gdclass(name: string?, extends: GDClassDefinition | ClassGlobal?): GDClassDefinition

--[[--
    Yields the current thread and waits before resuming.
    @param duration The duration to wait. If the engine is affected by a time factor, this duration will be affected by it.
]]
declare function wait(duration: number): number

--[[--
    Yields the current thread and waits for the signal to be emitted before resuming.
    @param signal The signal.
    @param timeout The number of seconds to wait before timing out (default: 10 seconds).
    @return The first return value is whether the signal was emitted (true) or timed out (false), and subsequent values are the arguments passed to the signal when it was emitted.
]]
declare function wait_signal&lt;T...&gt;(signal: Signal, timeout: number?): (true, T...) | false

--[[--
    Gets a global constant (e.g. AutoLoad) which was defined in the Godot editor.
    @param name The name of the global constant.
]]
declare function gdglobal(name: string | StringName): Variant
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-idiomatic-class"><a class="header" href="#the-idiomatic-class">The &quot;Idiomatic&quot; Class</a></h1>
<p>As this project is still in early stages, you shouldn't consider this syntax/interface stable yet.</p>
<p>At any rate, the following class provides an example as to what is currently considered &quot;idiomatic&quot; and type checkable:</p>
<pre><code class="language-lua">--!strict
local MyClassImpl = {}
local MyClass = gdclass(&quot;MyClass&quot;, Resource)
    :RegisterImpl(MyClassImpl)

-- These items registered on the impl will be accessible by indexing `MyClass`,
-- making them accessible to other scripts if they `require` this one.
MyClassImpl.TestEnum = {
    ONE = 1,
    TWO = 2,
    THREE = 3,
}

MyClassImpl.TEST_CONSTANT = &quot;hello!&quot;

-- Includes any custom fields/properties (essentially anything except methods)
type MyClassT = {
    testProperty: number,
}

export type MyClass = Resource &amp; MyClassT &amp; typeof(MyClassImpl)

-- Register a property to be accessible in the editor
MyClass:RegisterProperty(&quot;testProperty&quot;, Enum.VariantType.FLOAT)
    :Range(0, 1, 0.1)
    :Default(0.5)

function MyClassImpl.TestMethodAST(self: MyClass, arg1: number, arg2: TypedArray&lt;Resource&gt;): Variant
    return 123
end

-- Register a method to be accessible to Godot, based on its type annotations
MyClass:RegisterMethodAST(&quot;TestMethodAST&quot;)
    :DefaultArgs(5, Array.new())

function MyClassImpl.TestMethodManual(self: MyClass, arg1: number, arg2: string): RefCounted
    return self
end

-- Register a method manually. Not recommended unless the above method fails or you are not using type checking.
MyClass:RegisterMethod(&quot;TestMethodManual&quot;)
    :Args(
        { name = &quot;arg1&quot;, type = Enum.VariantType.FLOAT },
        { name = &quot;arg2&quot;, type = Enum.VariantType.STRING }
    )
    :ReturnVal({ type = Enum.VariantType.OBJECT })

return MyClass
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="virtual-methods"><a class="header" href="#virtual-methods">Virtual Methods</a></h1>
<p><code>godot-luau-script</code> supports the overriding of virtual methods.</p>
<h2 id="defined-in-an-object-class"><a class="header" href="#defined-in-an-object-class">Defined in an <code>Object</code> class</a></h2>
<p>If a virtual method such as <code>_process</code> or <code>_ready</code> is defined on an <code>Object</code>-type class,
you can override it by defining it in your implementation table and registering it to Godot.</p>
<h2 id="built-in-to-godot-luau-script"><a class="header" href="#built-in-to-godot-luau-script">Built in to <code>godot-luau-script</code></a></h2>
<p>This project comes with a number of built-in virtual methods, which can be overridden just by defining them on your implementation table.
They do not need to be registered to Godot.</p>
<h3 id="function-_initobj-object-table-"><a class="header" href="#function-_initobj-object-table-"><code>function _Init(obj: Object, table): ()</code></a></h3>
<p><code>_Init</code> is called as soon as an <code>Object</code> with your script is instantiated.</p>
<p>At this time, you gain access to the underlying table for your script instance,
where you can set a metatable on it or initialize any fields that do not need to be registered to Godot as a property.</p>
<h3 id="function-_notificationself-what-number-"><a class="header" href="#function-_notificationself-what-number-"><code>function _Notification(self, what: number): ()</code></a></h3>
<p><code>_Notification</code> is called whenever your object receives a notification.
Refer to Godot documentation to see what notifications you may receive.</p>
<h3 id="function-_tostringself-string"><a class="header" href="#function-_tostringself-string"><code>function _ToString(self): string</code></a></h3>
<p><code>_ToString</code> is called whenever Godot wants to stringify your object, for example when printing your object or calling <code>tostring</code>.
It should return the string representation of your object.</p>
<h3 id="custom-property-methods"><a class="header" href="#custom-property-methods">Custom property methods</a></h3>
<p>These methods should be used in combination to define custom properties for your object, typically so they can show up in the editor.
Keep in mind you must set <code>:Tool(true)</code> on your class for these methods to run in the editor.</p>
<h4 id="function-_getpropertylistself-gdproperty"><a class="header" href="#function-_getpropertylistself-gdproperty"><code>function _GetPropertyList(self): {GDProperty}</code></a></h4>
<p>This function should return a list of additional properties to be registered to Godot.</p>
<h4 id="function-_setself-name-string-value-variant-boolean"><a class="header" href="#function-_setself-name-string-value-variant-boolean"><code>function _Set(self, name: string, value: Variant): boolean</code></a></h4>
<p>This function should handle setting a value for a custom property.
It should return <code>true</code> when it set the value successfully, and <code>false</code> when it did not (or when the property doesn't exist).</p>
<h4 id="function-_getself-name-string-variant"><a class="header" href="#function-_getself-name-string-variant"><code>function _Get(self, name: string): Variant</code></a></h4>
<p>This function should handle getting a value for a custom property.
It should return the value of the property or <code>nil</code> if the property doesn't exist.</p>
<h4 id="function-_propertycanrevertself-name-string-boolean"><a class="header" href="#function-_propertycanrevertself-name-string-boolean"><code>function _PropertyCanRevert(self, name: string): boolean</code></a></h4>
<p>This function should return <code>true</code> if the given property has a default value which the editor should be able to revert to.</p>
<h4 id="function-_propertygetrevertself-name-string-variant"><a class="header" href="#function-_propertygetrevertself-name-string-variant"><code>function _PropertyGetRevert(self, name: string): Variant</code></a></h4>
<p>This function should be overridden along with <code>_PropertyCanRevert</code>.
It should return the default value of the given property, or <code>nil</code> if it doesn't exist.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="core-scripts-vms-and-permissions"><a class="header" href="#core-scripts-vms-and-permissions">&quot;Core Scripts&quot;, VMs, and Permissions</a></h1>
<p>These three concepts are essential to <code>godot-luau-script</code>'s sandboxing and security.</p>
<h2 id="core-scripts"><a class="header" href="#core-scripts">&quot;Core Scripts&quot;</a></h2>
<p>A core script is any script which is available in the filesystem whenever <code>godot-luau-script</code> is loaded.
This means that any scripts part of a .pck file that was loaded after <code>godot-luau-script</code> should be declared non-core.</p>
<h2 id="vms"><a class="header" href="#vms">VMs</a></h2>
<p><code>godot-luau-script</code> currently runs 3 different Luau VMs for different use cases:</p>
<ol>
<li>The loading VM, which is used to load essential script information (essentially, everything outside of its implementation table).</li>
<li>The core VM, which is where all core scripts are executed.</li>
<li>The user VM, which is where all non-core scripts are executed.</li>
</ol>
<p>This provides a certain level of isolation and security in addition to thread sandboxing.</p>
<h3 id="method-calls"><a class="header" href="#method-calls">Method calls</a></h3>
<p>Within the same VM, any script can call any other script's methods, so long as they are defined in the implementation table.
Between VMs, scripts can only call other scripts' methods if they are registered to Godot.
This gives a rough notion of &quot;public&quot; and &quot;private&quot;.</p>
<h2 id="permissions"><a class="header" href="#permissions">Permissions</a></h2>
<p>As mentioned in the introduction, <code>godot-luau-script</code> was primarily created to load untrusted scripts safely.
This means that certain Godot APIs must be locked behind special permissions, and that scripts will need to declare these permissions to receive them.</p>
<p>The specific permission levels are listed in <code>definitions/luauLibTypes.part.d.lua</code> and in the <code>godot-luau-script</code> API Reference.
As noted there, only a core script can declare its own permissions.</p>
<p>Certain APIs receive special perimssions, with <code>INTERNAL</code> being the default.
Permissions are set on the thread level, and are inherited to child threads.
If a thread ever tries to execute a method or other code of a permission level it does not have, it will cause an error.</p>
<p>A comprehensive list of the permissions assigned to every Object class and method can be seen at <code>bindgen/class_permissions.toml</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modules"><a class="header" href="#modules">Modules</a></h1>
<p><code>godot-luau-script</code> supports non-class module scripts and the <code>require</code> function.</p>
<h2 id="require"><a class="header" href="#require"><code>require</code></a></h2>
<p>The <code>require</code> function accepts a path relative to the current script, without the <code>.lua</code> extension.
It will load the file at the given path and return whatever the file returned.</p>
<p>Requires are cached within the same Lua VM, and are reloaded when necessary (if the script changes).</p>
<p>Please note that cyclic requires are not supported and may cause odd behavior in the editor if encountered.
Cyclic requires may also be caused by a base class requiring a script that inherits it.</p>
<h2 id="module-scripts"><a class="header" href="#module-scripts">Module scripts</a></h2>
<p><code>require</code> can require a script (class) file, in which case it will return the <code>GDClassDefinition</code> of the class.</p>
<p>However, you may want to create your own Lua types which don't need to be accessible to Godot.
To do this in a dedicated file, create a file with the extension <code>.mod.lua</code> which returns a function or a table.</p>
<p>Then, you will be able to require this file (being sure to include the <code>.mod</code> but not the <code>.lua</code> in the require path).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-scheduler"><a class="header" href="#task-scheduler">Task Scheduler</a></h1>
<p><code>godot-luau-script</code> borrows the task scheduler (among other concepts) from Roblox.</p>
<p>Currently, the task scheduler is only responsible for resuming yielded threads and running the garbage collector.</p>
<p>It updates once every frame.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="typechecking-and-autocomplete"><a class="header" href="#typechecking-and-autocomplete">Typechecking and Autocomplete</a></h1>
<p>Upon building, <code>godot-luau-script</code> will generate a single type definition file for use by Luau's analyzer.</p>
<p>Currently, autocomplete and analysis in the Godot editor is not supported.
As such, the most viable setup is to use Visual Studio Code and the <a href="https://github.com/JohnnyMorganz/luau-lsp">luau-lsp</a> extension.</p>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>After installing VSCode and the extension above, you will need to do the following setup:</p>
<ul>
<li>Set the preference <code>luau-lsp.require.mode</code> to <code>relativeToFile</code> to make <code>require</code> relative to the current script.</li>
<li>Set the preference <code>luau-lsp.types.roblox</code> to <code>false</code> to disable Roblox types being loaded by default.</li>
<li>Set the preference <code>luau-lsp.types.definitionFiles</code> to an array containing the path to <code>definitions/luauScriptTypes.gen.d.lua</code>.</li>
<li>Set the FFlag <code>LuauRecursionLimit</code> to something higher than the default (e.g. 5000). This can be done through the <code>luau-lsp.fflags.override</code> preference.
<ul>
<li>This is necessary because the generated definition file is too large for Luau to parse by default.</li>
</ul>
</li>
</ul>
<p>After doing this (and reloading the workspace), you should get type checking and autocomplete for all Godot and <code>godot-luau-script</code> types.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="known-issues"><a class="header" href="#known-issues">Known Issues</a></h1>
<p><code>godot-luau-script</code>, godot-cpp, Godot's GDExtension script language interface, and Godot 4 itself are all unstable.
As such, you may experience significant issues when using all of these things together.</p>
<h2 id="upstream-issue-godot-segfaults-on-exit"><a class="header" href="#upstream-issue-godot-segfaults-on-exit">Upstream issue: Godot segfaults on exit</a></h2>
<p>Tracking <a href="https://github.com/godotengine/godot-cpp/issues/889">godot-cpp#889</a>.</p>
<h2 id="upstream-issue-godot-crashes-when-loading-a-project-for-the-first-time"><a class="header" href="#upstream-issue-godot-crashes-when-loading-a-project-for-the-first-time">Upstream issue: Godot crashes when loading a project for the first time</a></h2>
<p>This likely occurs because the <code>ScriptLanguage</code> is used before initialization when the extension is loaded for the first time
(or, that it is used during asset reimport somehow).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tests"><a class="header" href="#tests">Tests</a></h1>
<p><code>godot-luau-script</code> contains tests written using the <a href="https://github.com/catchorg/Catch2">Catch2</a> framework.
They can be built using the <code>tests=yes</code> flag when running <code>scons</code>.</p>
<p>Tests can be run by running Godot in the <code>test_project</code> directory with the <code>--luau-tests</code> flag.
Then, Catch2 flags can be given after supplying a <code>--</code> argument.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging"><a class="header" href="#debugging">Debugging</a></h1>
<p>Assuming you built <code>godot-luau-script</code> with the <code>debug_symbols=yes</code> flag,
you will be able to debug the project by running Godot with a deubgger attached.</p>
<p>In case you run into issues which the debugger cannot trace, they may be caused by Godot engine code.
You can debug engine code by cloning Godot and building it with debug symbols as well.
Be sure to <code>git checkout</code> the commit matching the current supported version of Godot before building.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
